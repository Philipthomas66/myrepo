---
title: "Assessment 4 Philip Final"
author: "Philip"
date: "2025-10-05"
output: html_document
---

Part 1 
Q1 – Download the gene expression data
Used the download.file() function to retrieve the gene_expression.tsv file directly from the GitHub repository and save it locally for analysis.

```{r}
#Q1 Download from the assignment repository in Github
url_counts <- "https://raw.githubusercontent.com/ghazkha/Assessment4/main/gene_expression.tsv"
download.file(url_counts, destfile = "gene_expression.tsv", quiet = TRUE)

```
 Read and prepare the data
Read the tab-separated data into R using read.table(), set the first column (gene IDs) as row names, and removed it from the main data frame
```{r}
# Read table; make gene IDs the row names 
tbl <- read.table("gene_expression.tsv", header = TRUE, sep = "\t", stringsAsFactors = FALSE)
row.names(tbl) <- tbl[,1]
tbl <- tbl[ , -1]

# Show table for first six genes  
head(tbl, 6)

```
Q2 – Calculate mean expression for each gene
Used the rowMeans() function to compute the mean expression value across all samples for each gene and added this as a new column mean_expr.

```{r}
#Q2 Add mean across samples 
tbl$mean_expr <- rowMeans(tbl)
head(tbl, 6)

```
Q3 –Top 10 genes with highest mean expression
Sorted the dataset in descending order by mean_expr using order(tbl$mean_expr) and displayed the top 10.
```{r}
# Q3 List the 10 genes with highest mean
head(tbl[order(-tbl$mean_expr), , drop=FALSE], 10)

```
Q4 –  Count of genes with mean expression < 10
Used the logical condition tbl$mean_expr < 10 with the sum() function to count how many genes meet that condition
```{r}
#Q4 Number of genes with mean < 10
sum(tbl$mean_expr < 10)

```
Q5 – Histogram of mean expression
Created a histogram using hist(tbl$mean_expr) to visualize the distribution of mean gene expression across all genes.
```{r}
# Q5 Create Histogram 
hist(tbl$mean_expr, xlab="Mean expression", main="Distribution of mean counts")

```
Q6 – Inspect tree growth data
Downloaded and read the growth_data.csv file from GitHub using read.csv().
Then used names(dt) to view the column names in the dataset.
```{r}
# Q6 download and find column names
url_growth <- "https://raw.githubusercontent.com/ghazkha/Assessment4/main/growth_data.csv"
download.file(url_growth, destfile = "growth_data.csv", quiet = TRUE)
dt <- read.csv("growth_data.csv", stringsAsFactors = FALSE)   

# Inspect column names
names(dt)

```
Q7 – Mean and standard deviation of tree circumference
Applied the tapply() function to calculate mean and standard deviation of circumference for each site in 2005 and 2020.
```{r}
# Q7: mean & standard deviation at start (2005) and end (2020) by site
with(dt, tapply(Circumf_2005_cm, Site, function(x) c(mean=mean(x), sd=sd(x))))
with(dt, tapply(Circumf_2020_cm, Site, function(x) c(mean=mean(x), sd=sd(x))))

```
Q8 – Boxplots for circumference comparison
Used boxplot() to visualize tree circumferences in 2005 and 2020, grouped by site.
```{r}
# Q8: Boxplots of start vs end circumference
boxplot(Circumf_2005_cm ~ Site, data=dt,
        ylab="Tree circumference (cm)", main="Start (2005) by site")
boxplot(Circumf_2020_cm ~ Site, data=dt,
        ylab="Tree circumference (cm)", main="End (2020) by site")

```
Q10 – Mean 10-year growth and comparison between sites
Calculated 10-year growth using:
dt$growth_10y <- dt$Circumf_2020_cm - dt$Circumf_2010_cm
Then used tapply() to get mean growth per site and t.test() to test for significant differences between sites.
```{r}
# Q9: Mean growth over the last 10 years (2010–2020) at each site
dt$growth_10y <- dt$Circumf_2020_cm - dt$Circumf_2010_cm
with(dt, tapply(growth_10y, Site, mean))

```
Q10: Estimating the 10-year growth at the two sites
To determine if there was a significant difference in tree growth between the two sites over a 10-year period (2010–2020)
Here, growth_10y represents the growth in tree circumference over 10 years, and Site is the grouping variable representing the different locations.
This test compares the mean growth at the two sites and checks whether the difference is statistically significant.Here, growth_10y represents the growth in tree circumference over 10 years, and Site is the grouping variable representing the different locations.
This test compares the mean growth at the two sites and checks whether the difference is statistically significant.

```{r}
# Q10: estimating the 10 year growth at the two sites.
t.test(growth_10y ~ Site, data=dt)
```



Part 2 
Directory sequinr and R.utils were loaded 

```{r}
# load directory 
library(seqinr)
library(R.utils)


```
1. Number of coding sequences (CDS)
The complete CDS FASTA files for Oxalobacter formigenes (OXCC13) and Escherichia coli (K-12 MG1655) were downloaded from the Ensembl Bacteria FTP server using download.file().
After decompression with gunzip(), sequences were read into R using read.fasta().
The total number of CDS entries was obtained using length() for each organism.
```{r}
#Q1 Download Oxalobacter formigenes CDS
url_oxa <- "https://ftp.ensemblgenomes.ebi.ac.uk/pub/bacteria/release-62/fasta/bacteria_10_collection/oxalobacter_formigenes_oxcc13_gca_000158495/cds/Oxalobacter_formigenes_oxcc13_gca_000158495.ASM15849v1.cds.all.fa.gz"
download.file(url_oxa, destfile="oxalobacter_formigenes_cds.fa.gz", quiet=TRUE)
gunzip("oxalobacter_formigenes_cds.fa.gz", overwrite=TRUE)
cds_oxa <- read.fasta("oxalobacter_formigenes_cds.fa", seqtype="DNA")

# Download E. coli MG1655 CDS
url_ecoli <- "https://ftp.ensemblgenomes.ebi.ac.uk/pub/bacteria/release-62/fasta/bacteria_0_collection/escherichia_coli_str_k_12_substr_mg1655_gca_000005845/cds/Escherichia_coli_str_k_12_substr_mg1655_gca_000005845.ASM584v2.cds.all.fa.gz"
download.file(url_ecoli, destfile="ecoli_cds.fa.gz", quiet=TRUE)
gunzip("ecoli_cds.fa.gz", overwrite=TRUE)
cds_ecoli <- read.fasta("ecoli_cds.fa", seqtype="DNA")

```
```{r}
# Q1: to find number of CDS entries
n_cds <- data.frame(
  Organism  = c("E. coli K-12 MG1655", "Oxalobacter formigenes OXCC13"),
  CDS_count = c(length(cds_ecoli), length(cds_oxa))
)
knitr::kable(n_cds, caption = "Number of coding sequences (CDS)")

```
Obsv-E. coli encodes more genes than O. formigenes, reflecting its larger genome and broader metabolic capacity.


2. Total coding DNA and CDS summary lengths
For each CDS, sequence length was extracted using summary() on the FASTA object.
The total base pairs, mean, and median CDS lengths were then computed using sum(), mean(), and median() respectively.

```{r}
#Q2 Coding DNA Present :Per-CDS lengths from the fasta objects
len_ecoli <- as.numeric(summary(cds_ecoli)[, 1])
len_oxa   <- as.numeric(summary(cds_oxa)[, 1])

total_bp <- data.frame(
  Organism   = c("E. coli K-12 MG1655", "Oxalobacter formigenes OXCC13"),
  Total_bp   = c(sum(len_ecoli), sum(len_oxa)),
  Mean_len   = c(mean(len_ecoli), mean(len_oxa)),
  Median_len = c(median(len_ecoli), median(len_oxa))
)
knitr::kable(total_bp, caption = "Total coding DNA and summary lengths (bp)")

```
Obsv-CDS sizes are typical for prokaryotes, though E. coli’s total coding content is almost double that of O. formigenes.


Q3- Distribution of CDS lengths
CDS lengths for both species were visualized using a boxplot (boxplot() function) to compare their distributions.
The mean and median lengths were also displayed numerically.
```{r}
#Q3 Plot Boxplot of CDS lengths
boxplot(list(`E. coli` = len_ecoli, `Oxalobacter formigenes OXCC13` = len_oxa),
        ylab = "CDS length (bp)", main = "CDS length distributions")

#  length of all coding sequences (Print mean + median again)
c( mean_ecoli   = mean(len_ecoli),   median_ecoli   = median(len_ecoli),
  mean_oxa     = mean(len_oxa),     median_oxa     = median(len_oxa)
)

```
Obsv-Both organisms show similar CDS length patterns, but E. coli genes are slightly longer on average, consistent with its higher gene count.


Q4-Base composition in coding sequences
All CDS were flattened into nucleotide vectors (unlist()), filtered to include only A, C, G, and T bases, and counted using table().
The base frequencies were then visualized with barplot() for each organism
The CDS of E. coli and Oxalobacter formigenes were translated into proteins using seqinr::translate(). Stop codons were removed, amino acid frequencies were counted with table(), and results were visualized as bar plots.
```{r}
#Q4 frequency of DNA bases in the total coding sequences for both organisms
# Flatten all CDS, 
dna_ecoli <- toupper(unlist(cds_ecoli))
dna_ecoli <- dna_ecoli[dna_ecoli %in% c("A","C","G","T")]

dna_oxa <- toupper(unlist(cds_oxa))
dna_oxa <- dna_oxa[dna_oxa %in% c("A","C","G","T")]

# Count with zero-protected levels
basefreq_ecoli <- table(factor(dna_ecoli, levels = c("A","C","G","T")))
basefreq_oxa   <- table(factor(dna_oxa,   levels = c("A","C","G","T")))

# Bar Plots
barplot(basefreq_ecoli, main="E. coli base composition", ylab="Count", xlab="Base")
barplot(basefreq_oxa,   main="Oxalobacter formigenes base composition", ylab="Count",xlab="Base")

```
The analysis of the protein-coding sequences revealed distinct patterns between E. coli and Oxalobacter formigenes. The higher GC content observed in O. formigenes suggests a genome-level compositional bias, which directly affects its codon usage and consequently its amino acid composition.
GC-rich genomes tend to prefer codons ending in G or C, leading to a higher frequency of amino acids encoded by GC-rich codons such as Glycine (G), Alanine (A), Proline (P), and Arginine (R). In contrast, E. coli, with a more balanced AT–GC ratio, exhibits a broader and more evenly distributed codon usage pattern.

These differences in codon and amino acid composition may reflect adaptations to the organisms’ ecological niches and metabolic requirements. Codon bias can influence translation efficiency and gene expression levels, meaning O. formigenes may have evolved codon preferences that optimize protein synthesis under its specific environmental and physiological conditions.

```{r}
# Translate CDS -> proteins
prot_ecoli <- lapply(cds_ecoli, seqinr::translate)
prot_oxa   <- lapply(cds_oxa,   seqinr::translate)

```
```{r}
# Flatten to single vectors of one-letter AAs and drop stops
aa_ecoli <- unlist(prot_ecoli)
aa_oxa   <- unlist(prot_oxa)
aa_ecoli <- aa_ecoli[aa_ecoli != "*"]
aa_oxa   <- aa_oxa[aa_oxa != "*"]

# Fixed 20-AA alphabet
aa_levels <- strsplit("ACDEFGHIKLMNPQRSTVWY", "")[[1]]

# Counts with zero-protected levels
aafreq_ecoli <- table(factor(aa_ecoli, levels = aa_levels))
aafreq_oxa   <- table(factor(aa_oxa,   levels = aa_levels))

# Plots
barplot(aafreq_ecoli, las = 2, ylab = "Count",
        main = "E. coli amino acid composition", xlab = "Amino acid")
barplot(aafreq_oxa,   las = 2, ylab = "Count",
        main = "Oxalobacter formigenes amino acid composition", xlab = "Amino acid")
```

The amino acid composition analysis revealed clear differences between E. coli and Oxalobacter formigenes. E. coli displayed a relatively balanced distribution of amino acids, with higher levels of leucine, alanine, and glycine, reflecting its versatile metabolic capacity and ability to adapt to varied environments. In contrast, O. formigenes showed a higher proportion of GC-rich amino acids such as alanine, arginine, and glycine, which corresponds with its GC-rich genome. This suggests a strong codon usage bias and possible evolutionary adaptation to its specialized gut habitat. Overall, the variation in amino acid composition between the two organisms highlights how genomic content influences protein composition and reflects distinct ecological and physiological adaptations.


Q5-Codon usage and bias
Codon usage bias was quantified using the Relative Synonymous Codon Usage (RSCU) index, calculated with uco() for each organism.
Results were compared visually with barplots of RSCU values.
```{r}
# Q5:  codon usage table and quantify the codon usage bias among all coding sequences

# E. coli RSCU across all CDS
rscu_ecoli <- uco(unlist(cds_ecoli), index="rscu", as.data.frame=TRUE)

# Oxalobacter formigenes across all CDS
rscu_oxa   <- uco(unlist(cds_oxa),   index="rscu", as.data.frame=TRUE)

# Show first 10 codons for each organism
head(rscu_ecoli, 10)
head(rscu_oxa, 10)

# Compare visually with barplots
barplot(rscu_ecoli$freq, names.arg=rscu_ecoli$codon,
        las=2, main="E. coli codon usage (RSCU)", cex.names=0.6, ylab="RSCU")
barplot(rscu_oxa$freq, names.arg=rscu_oxa$codon,
        las=2, main="Oxalobacter formigenes codon usage", cex.names=0.6, ylab="RSCU")

```
E. coli codon usage: Prefers A/T-ending codons.
O. formigenes codon usage: Favors G/C-ending codons, showing a higher codon bias.

Codon preferences reflect species-specific genomic composition and tRNA availability.
O. formigenes demonstrates stronger codon bias consistent with its GC-rich genome.


Q6 – Identification of Protein Sequence k-mers (k = 3–5)
Protein sequences from E. coli and Oxalobacter formigenes were flattened into single-character vectors, and stop codons were removed. Using the count() function, amino acid subsequences (k-mers) of lengths 3, 4, and 5 were identified. The frequencies of all possible k-mers were calculated, and the top 10 most over-represented and under-represented 3-mers were plotted for O. formigenes. Similar patterns were compared to E. coli for reference.And was repeated for 4 mers and 5 mers 
```{r}
# Q6: Identify 10 protein sequence k-mers (k = 3–5) for both E. coli and Oxalobacter

# Flatten proteins into single character vectors
prots_ecoli <- unlist(lapply(cds_ecoli, translate))
prots_oxa   <- unlist(lapply(cds_oxa,   translate))

# Define amino acid alphabet (remove stop codons '*')
aa <- unique(prots_ecoli)
aa <- aa[aa != "*"]

### -------------------------------
### K = 3 analysis
### -------------------------------
k3_ecoli <- count(prots_ecoli, wordsize=3, alphabet=aa)
k3_oxa   <- count(prots_oxa,   wordsize=3, alphabet=aa)

# Top 10 over- and under-represented 3-mers
top_over_ecoli3  <- head(sort(k3_ecoli, decreasing=TRUE), 10)
top_under_ecoli3 <- head(sort(k3_ecoli, decreasing=FALSE),10)
top_over_oxa3    <- head(sort(k3_oxa,   decreasing=TRUE), 10)
top_under_oxa3   <- head(sort(k3_oxa,   decreasing=FALSE),10)

# Bar plots (E. coli vs Oxalobacter)
par(mfrow=c(2,2))
barplot(as.numeric(top_over_ecoli3), names.arg=names(top_over_ecoli3),
        las=2, main="E. coli: Top 10 over-represented 3-mers", col="lightblue")
barplot(as.numeric(top_under_ecoli3), names.arg=names(top_under_ecoli3),
        las=2, main="E. coli: Top 10 under-represented 3-mers", col="lightblue")
barplot(as.numeric(top_over_oxa3), names.arg=names(top_over_oxa3),
        las=2, main="Oxalobacter: Top 10 over-represented 3-mers", col="lightgreen")
barplot(as.numeric(top_under_oxa3), names.arg=names(top_under_oxa3),
        las=2, main="Oxalobacter: Top 10 under-represented 3-mers", col="lightgreen")

```
```{r}

### K = 4 analysis

k4_ecoli <- count(prots_ecoli, wordsize=4, alphabet=aa)
k4_oxa   <- count(prots_oxa,   wordsize=4, alphabet=aa)

# Top 10 over- and under-represented 4-mers
top_over_ecoli4  <- head(sort(k4_ecoli, decreasing=TRUE), 10)
top_under_ecoli4 <- head(sort(k4_ecoli, decreasing=FALSE),10)
top_over_oxa4    <- head(sort(k4_oxa,   decreasing=TRUE), 10)
top_under_oxa4   <- head(sort(k4_oxa,   decreasing=FALSE),10)

# Bar plots (E. coli vs Oxalobacter)
par(mfrow=c(2,2))
barplot(as.numeric(top_over_ecoli4), names.arg=names(top_over_ecoli4),
        las=2, main="E. coli: Top 10 over-represented 4-mers", col="lightblue")
barplot(as.numeric(top_under_ecoli4), names.arg=names(top_under_ecoli4),
        las=2, main="E. coli: Top 10 under-represented 4-mers", col="lightblue")
barplot(as.numeric(top_over_oxa4), names.arg=names(top_over_oxa4),
        las=2, main="Oxalobacter: Top 10 over-represented 4-mers", col="lightgreen")
barplot(as.numeric(top_under_oxa4), names.arg=names(top_under_oxa4),
        las=2, main="Oxalobacter: Top 10 under-represented 4-mers", col="lightgreen")


```
```{r}
### K = 5 analysis

k5_ecoli <- count(prots_ecoli, wordsize=5, alphabet=aa)
k5_oxa   <- count(prots_oxa,   wordsize=5, alphabet=aa)

# Top 10 over- and under-represented 5-mers
top_over_ecoli5  <- head(sort(k5_ecoli, decreasing=TRUE), 10)
top_under_ecoli5 <- head(sort(k5_ecoli, decreasing=FALSE),10)
top_over_oxa5    <- head(sort(k5_oxa,   decreasing=TRUE), 10)
top_under_oxa5   <- head(sort(k5_oxa,   decreasing=FALSE),10)

# Bar plots (E. coli vs Oxalobacter)
par(mfrow=c(2,2))
barplot(as.numeric(top_over_ecoli5), names.arg=names(top_over_ecoli5),
        las=2, main="E. coli: Top 10 over-represented 5-mers", col="lightblue")
barplot(as.numeric(top_under_ecoli5), names.arg=names(top_under_ecoli5),
        las=2, main="E. coli: Top 10 under-represented 5-mers", col="lightblue")
barplot(as.numeric(top_over_oxa5), names.arg=names(top_over_oxa5),
        las=2, main="Oxalobacter: Top 10 over-represented 5-mers", col="lightgreen")
barplot(as.numeric(top_under_oxa5), names.arg=names(top_under_oxa5),
        las=2, main="Oxalobacter: Top 10 under-represented 5-mers", col="lightgreen")

```


The frequent occurrence of certain amino acid triplets (3-mers) in O. formigenes suggests evolutionary preferences in protein sequence composition, possibly reflecting adaptations to its specific metabolic and environmental needs. In contrast, E. coli shows a more even distribution of motifs, consistent with its broader metabolic versatility. Identifying recurring k-mers helps in understanding protein folding patterns, conserved motifs, and evolutionary relationships between species.

The k-mer analysis revealed that shorter motifs such as 3-mers were more frequently represented across protein sequences, showing clear patterns of over- and under-representation that may reflect conserved structural or functional regions. In contrast, 4-mers displayed lower overall frequencies, indicating increased sequence variability and fewer recurring motifs. The 5-mers were the least common, with many combinations absent entirely, suggesting that longer amino acid patterns are highly specific and rare within the protein dataset. Overall, as k increased, the diversity of possible motifs grew exponentially, leading to reduced repetition and highlighting sequence complexity.

